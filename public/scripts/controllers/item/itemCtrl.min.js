/*! collection-application 2017-06-08 */

"use strict";angular.module("collectionApp").directive("fileModel",["$parse",function(t){return{restrict:"A",link:function(e,a,i){var n=t(i.fileModel).assign;a.bind("change",function(){e.$apply(function(){n(e,a[0].files[0])})})}}}]).controller("itemCtrl",["$scope","$http","$location","User",function(t,e,a,i){t.templateUrl="views/pages/dashboard/item/itemList.html?v="+window.app_version,t.showgrid=function(){t.templateUrl="views/pages/dashboard/item/itemGrid.html?v="+window.app_version},t.showlist=function(){t.templateUrl="views/pages/dashboard/item/itemList.html?v="+window.app_version},t.itemData={},t.newitemData=[];var n=function(){i.getPermission().then(function(a){var i=a.data.data.permission,n=a.data.data._id;"Admin"!=i?e.get("/itemList/"+n).success(function(a){t.itemData=a.data,angular.forEach(t.itemData,function(a,i){var n=t.itemData[i].collection_name,o=t.itemData[i]._id,c=t.itemData[i].item_name,m=t.itemData[i].password_protected,s=t.itemData[i].item_thumb,l=t.itemData[i].item_number;n==t.itemData[i].collection_name&&e.get("/collectionDetail/"+n).success(function(e){t.collection_name=e.data.collection_name,t.newitemData.push({collection_name:t.collection_name,item_id:o,item_name:c,password_protected:m,item_thumb:s,item_number:l})})})}):e.get("/itemList").success(function(a){t.itemData=a.data,angular.forEach(t.itemData,function(a,i){var n=t.itemData[i].collection_name,o=t.itemData[i]._id,c=t.itemData[i].item_name,m=t.itemData[i].password_protected,s=t.itemData[i].item_thumb,l=t.itemData[i].item_number;n&&e.get("/collectionDetail/"+n).success(function(e){t.collection_name=e.data.collection_name,t.newitemData.push({collection_name:t.collection_name,item_id:o,item_name:c,password_protected:m,item_thumb:s,item_number:l})})})})})};n(),t.deleteItem=function(a){e.delete("/deleteItem/"+a).success(function(e){alert("Item delete successfully."),t.newitemData=[],n()})},t.viewItem=function(t){a.path("/dashboard/item/info/"+t)},t.editItem=function(t){a.path("/dashboard/item/info/"+t+"/edit")}}]).controller("itemCreateCtrl",["$scope","$http","$location","User","$stateParams","$timeout",function(t,e,a,i,n,o){t.itemData={},t.itemData.item_thumb="default.jpg",t.itemData.create_date=new Date,t.getNumber=function(){var e=new Date,a=e.getFullYear().toString();a+=e.getUTCMilliseconds(),a+=e.getHours()+e.getMinutes()+e.getSeconds()+e.getMilliseconds().toString(),t.itemData.item_number=a+Math.ceil(9*Math.random())},t.getNumber(),t.collectionData={};var c=function(){i.getPermission().then(function(a){t.itemData.user_id=a.data.data._id;var i=a.data.data._id;e.get("/collectionList/"+i).success(function(e){t.collectionData=e.data,o(function(){t.itemData.collection_name=n.id},500)})})};c(),t.showopt=!1,t.showOptField=function(){var a=t.itemData.collection_name;console.log(a),a?(t.showopt=!0,e.get("/collectionDetail/"+a).success(function(e){t.itemData.optional_field_name=e.data.opt_field})):t.showopt=!1},t.uploadImage=function(){var a=t.myFile,i=new FormData;i.append("file",a),e.post("/uploadItemImgFile",i,{transFormRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(e){t.itemData.item_thumb=e.filename,alert("image upload successfully")}).error(function(){})},t.errorMsg=!1,t.successMsg=!1,t.insertItem=function(){console.log(t.itemData),t.itemData.item_name?t.itemData.collection_name?e.post("/insertItem",t.itemData).success(function(e){var i=e.data.collection_name;t.successMsg=e.message,alert("Item save successfully"),a.path("/dashboard/collection/items/"+i),t.itemData={},c()}):(t.errorMsg="Please Select collection or create collection before add an item",alert("invalid Entry")):(t.errorMsg="Please Enter Item Name",alert("invalid Entry"))},t.cancel=function(){a.path("/dashboard/item/info/")}}]).controller("UDRItemCtrl",["$scope","$http","$stateParams","$location","Auth","User","$timeout",function(t,e,a,i,n,o,c){t.infoItem=function(t){i.path("/dashboard/item/info/"+t)},t.editItem=function(t){i.path("/dashboard/item/info/"+t+"/edit")},t.auth={},n.isLoggedIn()&&o.getPermission().then(function(e){var a=e.data.data.permission;t.auth.user_id=e.data.data._id,"Admin"===a?t.ItemNumber=!0:"User"===a&&(t.ItemNumber=!1)}),t.collectionData={};!function(){o.getPermission().then(function(a){t.itemData.user_id=a.data.data._id;var i=a.data.data._id;i&&e.get("/collectionList/"+i).success(function(e){t.collectionData=e.data,console.log(e.data),c(function(){m()},100)})})}(),t.itemData={};var m=function(){e.get("/itemDetail/"+a.id).success(function(a){t.itemData=a.data,t.itemData.create_date=new Date(t.itemData.create_date),console.log(a.data.collection_name);var i=t.itemData.collection_name;console.log(i),i==t.itemData.collection_name&&e.get("/collectionDetail/"+i).success(function(e){t.collection_name=e.data.collection_name})})};t.uploadImage=function(){var a=t.myFile,i=new FormData;i.append("file",a),e.post("/uploadItemImgFile",i,{transFormRequest:angular.identity,headers:{"Content-Type":void 0}}).success(function(e){t.itemData.item_thumb=e.filename}).error(function(){})},t.updateItem=function(){e.put("/updateItem/"+t.itemData._id,t.itemData).success(function(e){alert("Item detail successfully updated"),i.path("/dashboard/item/info/"+t.itemData._id)})},t.cancel=function(t){i.path("/dashboard/item/info/"+t)}}]);